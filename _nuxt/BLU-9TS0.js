import{_ as J}from"./B6i5lCio.js";import{V as O,_ as Q,W as Y,a7 as Z,a8 as ee,a0 as te,ab as ae,a2 as se,a1 as h,i as c,j as U,k as le,l as ne,f as z,x as p,X as e,o as V,a as l,b as oe,t as u,u as w,K as P,aj as ie,a5 as re,a6 as ce}from"./JoFQSik9.js";import{_ as ue}from"./sQNTZNBq.js";import{_ as _e}from"./DG4EeLIg.js";import{_ as de}from"./Cf_ozb67.js";import{u as pe}from"./CkHyjaJP.js";import{g as $}from"./BZw8aVXh.js";import"./L3qbADmP.js";import"./Cel6GgYv.js";import"./ElL4sWVy.js";import"./1-N0yLDQ.js";const me={class:"tw-grow"},ve={class:"players"},be={class:"tw-text-text-tertiary"},fe={class:"invite"},ye={class:"tw-text-text-tertiary"},ge={class:"tw-text-text-brand"},he={class:"tw-flex tw-itwms-center tw-gap-1"},we=["src"],Be={class:"tw-flex tw-itwms-center tw-gap-1"},xe=["src"],ke=O({__name:"lobby-[id]",setup(Ie){const{t:a}=Q(),j=Y(),D=Z(),{setBreadcrumbs:G}=pe();G([{label:a("battles"),path:j({name:"battles"})},{label:a("pvp_lobby")}]);const B=ee(),R=te(),x=ae(),k=se(),{isLessContainerTablet:I,isMultiBalance:A}=h(R),{getUserBattle:_,getCurrency:H}=h(x),{isLoggedIn:K}=h(k),{switchUser:W}=k;let g,C;const m=c(!1),r=c(null),s=c(null),L=c([]),T=c(!0),X=c([{title:"#",align:"left",key:"position",width:"24px"},{title:a("players"),align:"left",key:"username"},{title:a("status"),align:"left",key:"status",hideTablet:!0,hideMobile:!0},{title:a("spins_lobby"),align:"left",key:"spins_left",hideTablet:!0,hideMobile:!0},{title:a("winnings"),align:"left",key:"winnings"},{title:a("consecutive_wins"),align:"left",key:"max_consecutive_wins",hideTablet:!0,hideMobile:!0},{title:a("max_multiplier"),align:"left",key:"max_multiplier",hideTablet:!0,hideMobile:!0},{title:a("prize"),align:"left",key:"prize"}]),q=U(()=>L.value.map((t,n)=>({position:n+1,...t,status:"leader_"+t.status.replace(" ","_").toLowerCase()}))),E=U(()=>I.value?"24px repeat(3, 1fr)":"24px repeat(7, 1fr)"),F=()=>{ie(location.href),m.value=!0,setTimeout(()=>{m.value=!1},4e3)},S=async()=>{const{data:t,status:n}=await B.fetchBattleByLink({link:D.params.id});if(n){if(clearInterval(g),s.value=t,r.value=t.battle_id,_.value){const o={..._.value};o.timer=t.timer,x.setUserBattle(o)}(t.battle_status===2||t.battle_status===1)&&(g=window.setInterval(()=>{S()},1e4))}else s.value=null,r.value=null},M=async t=>{const{data:n}=await B.fetchBattleLeaderBoard({battleId:t});L.value=n};return le(async()=>{var t,n,o,v,b,f,y,d;await S(),r.value&&(await M(r.value),(((t=s.value)==null?void 0:t.battle_status)===1||((n=s.value)==null?void 0:n.battle_status)===2)&&(C=window.setInterval(()=>{r.value&&M(r.value)},1e4))),K.value&&A.value&&((o=_.value)==null?void 0:o.player_origin_currency)!==H.value&&((v=_.value)==null?void 0:v.battle_link)===((b=s.value)==null?void 0:b.link)&&(((f=s.value)==null?void 0:f.battle_status)===1||((y=s.value)==null?void 0:y.battle_status)===2)&&W((d=_.value)==null?void 0:d.player_origin_currency),T.value=!1}),ne(()=>{clearInterval(g),clearInterval(C)}),(t,n)=>{const o=J,v=re,b=ue,f=_e,y=de;return V(),z(y,{loading:e(T),class:"lobby"},{default:p(()=>{var d,N;return[l("div",null,[e(s)?(V(),z(o,{key:0,item:e(s),"is-column":!e(I)},null,8,["item","is-column"])):oe("",!0)]),l("div",me,[l("div",ve,[l("span",be,u((d=e(s))==null?void 0:d.active_participant_count)+" "+u(e(a)("players")),1),l("div",fe,[l("span",ye,u(e(a)((N=e(s))!=null&&N.is_private?"private_match":"public_match")),1),w(b,{"label-key":e(m)?"link_copied":"invite_players","is-with-icon":"","color-type":"secondary","is-disabled":e(m),onClick:F},{default:p(()=>[w(v,{name:"copy",size:20})]),_:1},8,["label-key","is-disabled"])])]),w(f,{header:e(X),list:e(q),class:"leader-board",type:"grid","grid-templates":e(E)},{"header-winnings":p(({header:i})=>[l("span",ge,u(i.title),1)]),winnings:p(({item:i})=>[l("div",he,[P(u(i.winnings)+" ",1),l("img",{src:e($)(i.currency)},null,8,we)])]),prize:p(({item:i})=>[l("div",Be,[P(u(i.prize)+" ",1),l("img",{src:e($)(i.currency)},null,8,xe)])]),_:1},8,["header","list","grid-templates"])])]}),_:1},8,["loading"])}}}),je=ce(ke,[["__scopeId","data-v-ea602a9c"]]);export{je as default};
