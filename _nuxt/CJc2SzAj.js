import{d as ie,m as ue,j as _e,ax as de,b9 as me,G as ve,a as pe,aM as ge,aV as fe,ag as Ce,s as S,a0 as A,H as k,ba as u,ay as Ee,k as ye,l as Ne,w as Te,o as t,B as I,g as e,C as q,c as n,a1 as c,f as N,t as a,i as d,e as s,b as v,O as he,n as Me,T as Oe,aY as be,bb as z,aU as G,aQ as B,h as Se,A as Ae,p as ke}from"./7PQ9d4dP.js";import{_ as Ie}from"./DqC-nx6a.js";import{c as Be,_ as $e}from"./BQWyzQZp.js";import{_ as De}from"./UCCBr-NG.js";import"./DD170oM2.js";import"./D0WEjs_T.js";const we={class:"ng-bonus-modal-body"},Ve={class:"ng-bonus-modal-main"},Ue={class:"ng-bonus-modal-content"},Re={class:"message"},Pe={class:"message"},Le={class:"message"},Fe={class:"title"},We={class:"message"},Ye={class:"title"},qe={class:"message"},ze={key:0,class:"message"},Ge={class:"ng-bonus-modal-footer"},He={class:"ng-bonus-modal-cooldown"},je={class:"currency-selected-container"},Ke={class:"currency-selected-title"},Qe={class:"currency-selected-currency"},$=1e3,D="0:00",so=ie({__name:"NgBonusModal",setup(Ze){const H=ue(),w=_e(),V=de(),j=me(),{getIconName:K}=ve(),{t:Q}=pe(),{$emitter:U}=ge(),{activateMessageBonus:Z}=j,{hideModal:g,postActivateBonus:J}=V,X=fe().shape({promoCode:Ce().required(`${Q("promo_code_required_field")}`)}),{setShowVerificationModal:x}=w,{errors:ee}=Be({validationSchema:X}),{getActiveBonus:oe,getModalStatus:_,getCooldownModalLatestDate:R,getActivateModalBonus:O,getActivateModalType:P}=S(V),{getCurrency:L}=S(H),{isMultiBalance:te}=S(w),T=A(null);let E;const f=A(null),C=A(""),se=k(()=>{switch(_.value){case u.COOLDOWN:return!!f.value;case u.ACTIVATE:return!0;default:return!1}}),y=k(()=>{var o,r;return _.value===u.ACTIVATE&&((r=(o=O.value)==null?void 0:o.actions)==null?void 0:r.includes(Ee.PROMO_CODE))||!1}),ae=k(()=>!C.value||!!ee.value.promoCode),F=()=>{R.value?f.value=ce(new Date(R.value)):f.value=D},ne=()=>{switch(_.value){case u.COOLDOWN:F(),le();break}},ce=o=>{const r=new Date,i=60,l=5,m=i*$,h=l*m,M=new Date(o.getTime()+h).getTime()-r.getTime();let p=Math.floor(M/$),b=Math.floor(p/i);if(b>l||M<0)return D;b%=i,p%=i;const re=p<10?"0"+p:p;return`${b}:${re}`},le=()=>{E&&clearInterval(E),E=be(F,$)},W=async()=>{var r,i;if(!((r=O.value)!=null&&r.id)||y.value&&!C.value)return;T.value=null;const o={id:(i=O.value)==null?void 0:i.id};y.value&&(o.promo_code=C.value);try{if(P.value===z.MESSAGES&&(await Z(o),U.emit(G.BONUS_ACTIVATED),g()),P.value===z.BONUSES){const{id:l,promo_code:m=void 0}=o;await J(l,m),U.emit(G.BONUS_ACTIVATED),g()}}catch(l){const m=l;T.value=m,[B.PAYMENT_NEED_PROOF_EMAIL,B.PAYMENT_NEED_PROOF_PHONE,B.NEED_KYC_VERIFICATION].includes(m.error_code)&&x(!0)}};return ye(()=>{ne()}),Ne(()=>{E&&clearInterval(E)}),Te(()=>f.value,()=>{f.value===D&&g()}),(o,r)=>{const i=Se,l=Ae,m=Ie,h=ke,Y=$e,M=De;return t(),I(Oe,{to:"#globalModal"},[e(se)?(t(),I(M,{key:0,class:"ng-bonus-modal","modal-width":"512px","fullscreen-mode":"",onClose:e(g)},{title:q(()=>[e(_)===e(u).COOLDOWN?(t(),n(c,{key:0},[N(a(o.$t("bonus_сooldown")),1)],64)):d("",!0),e(_)===e(u).ACTIVATE?(t(),n(c,{key:1},[e(y)?(t(),n(c,{key:0},[N(a(o.$t("Bonus Activation")),1)],64)):(t(),n(c,{key:1},[N(a(o.$t("bonus_activate_req")),1)],64))],64)):d("",!0)]),content:q(()=>[s("div",we,[s("div",Ve,[v(i,{name:e(K)("present"),"is-init-color":"",size:80},null,8,["name"]),s("div",Ue,[e(_)===e(u).COOLDOWN?(t(),n(c,{key:0},[s("span",Re,a(o.$t("hey_we_crunch_result")+"🎮"),1),s("span",Pe,a(o.$t("not_more_than_5_min")),1),s("span",Le,a(o.$t("once_the_calc_are_done")+"🎁🚀"),1)],64)):d("",!0),e(_)===e(u).ACTIVATE?(t(),n(c,{key:1},[e(y)?(t(),n(c,{key:0},[s("span",Fe,a(o.$t("Bonus Name")),1),s("span",We,a(o.$t("bonus_modal_activate_promo_title")),1)],64)):(t(),n(c,{key:1},[s("span",Ye,a(o.$t("activate_bonus_modal_title")),1),s("span",qe,a(o.$t("bonus_modal_activate_title")),1),!e(te)&&e(oe)?(t(),n("span",ze,a(o.$t("activate_bonus_modal_warning_have_bonus")),1)):d("",!0)],64))],64)):d("",!0)])]),s("div",Ge,[e(_)===e(u).COOLDOWN?(t(),n(c,{key:0},[s("div",He,[v(i,{name:"time",size:20}),N(" "+a(e(f)),1)]),v(l,{"label-key":"close",onClick:e(g)},null,8,["onClick"])],64)):d("",!0),e(_)===e(u).ACTIVATE?(t(),n(c,{key:1},[e(y)?(t(),n(c,{key:0},[v(m,{modelValue:e(C),"onUpdate:modelValue":r[0]||(r[0]=p=>he(C)?C.value=p:null),"input-name":"promoCode","placeholder-text":o.$t("bonus_enter_promo_code"),"is-required":""},null,8,["modelValue","placeholder-text"]),v(l,{"label-key":"confirm","is-disabled":e(ae),onClick:W},null,8,["is-disabled"])],64)):(t(),n(c,{key:1},[s("div",je,[s("span",Ke,a(o.$t("currency_selected")),1),s("div",Qe,[N(a(e(L))+" ",1),v(h,{class:"currency-selected-icon",src:("getCurrencyIconUrl"in o?o.getCurrencyIconUrl:e(Me))(e(L)),alt:"currency"},null,8,["src"])])]),v(l,{"label-key":"activate_bonus_modal_btn_activate_multi",onClick:W}),v(l,{"label-key":"close","color-type":"secondary",onClick:e(g)},null,8,["onClick"])],64)),e(T)?(t(),I(Y,{key:2,error:e(T)},null,8,["error"])):d("",!0)],64)):d("",!0)])])]),_:1},8,["onClose"])):d("",!0)])}}});export{so as default};
