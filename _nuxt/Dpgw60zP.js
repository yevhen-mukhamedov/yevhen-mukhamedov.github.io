import{d as ee,X as he,j as se,s as te,a0 as g,H as F,be as Q,w as ae,o as y,c as S,b as o,g as s,O as ne,$ as H,e as p,t as b,aH as Z,C as k,U as q,p as ke,Y as be,_ as oe,a as Ce,b9 as we,aJ as Ne,bf as Me,as as $e,F as Te,f as xe,B as V,i as I,aK as Ve,h as Ie,a4 as Se,aq as De,A as Be,au as Le,V as Ae}from"./7PQ9d4dP.js";import{M as Ee,C as j,_ as Oe}from"./D5X7BfX4.js";import{_ as le}from"./C3H6epDl.js";import{a as Pe}from"./CXUEa_s4.js";import{_ as Re}from"./BFbZvv9A.js";import"./DqC-nx6a.js";import"./BQWyzQZp.js";import"./DD170oM2.js";import"./D0WEjs_T.js";import"./DPPwigSW.js";import"./UCCBr-NG.js";const Ue={class:"message-date--mobile"},ze={class:"message-text"},je={class:"tw-flex tw-items-center tw-justify-between tw-w-full"},Fe={class:"message-title"},He={class:"message-date"},qe={class:"message-desc"},Je=ee({__name:"MessageItem",props:{item:{},checked:{type:Boolean}},emits:["select"],setup(J,{emit:w}){const d=J,i=w,D=he(),N=se(),{isMobile:B}=te(N),v=g(!1),L=F(()=>{var n;return d.item.type===Q.tier_push||d.item.type===Q.tier_modal?"/img/tierNotyBanner.png":((n=d.item.message)==null?void 0:n.banner)||d.item.message_default.banner||"/img/tierNotyBanner.png"}),A=F(()=>({"message--checked":v.value,"message--mobile":B.value,"message--unread":!d.item.is_read}));return ae(()=>d.checked,n=>{v.value=n}),(n,_)=>{const M=le,E=ke,$=be;return y(),S("div",{class:q(["message",s(A)])},[o(M,{modelValue:s(v),"onUpdate:modelValue":_[0]||(_[0]=f=>ne(v)?v.value=f:null),type:s(H).check,class:"message-checkbox",onChange:_[1]||(_[1]=f=>i("select",n.item.id))},null,8,["modelValue","type"]),p("span",Ue,b(s(Z)(n.item.date)),1),o(E,{src:s(L),alt:"banner",class:"message-img"},null,8,["src"]),p("div",ze,[o($,{to:s(D)({path:`/messages/${n.item.id}`})},{default:k(()=>{var f,c,l,r;return[p("div",je,[p("h2",Fe,b(((c=(f=n.item)==null?void 0:f.message)==null?void 0:c.subject)||n.item.message_default.subject),1),p("span",He,b(s(Z)(n.item.date)),1)]),p("p",qe,b(((r=(l=n.item)==null?void 0:l.message)==null?void 0:r.description)||n.item.message_default.description),1)]}),_:1},8,["to"])])],2)}}}),Ke=oe(Je,[["__scopeId","data-v-24f96d57"]]),Ye={class:"ng-messages-caption ng-flex-center"},Ge={class:"messages-wrapper"},We={class:"messages-actions"},Xe={key:1,class:"tw-flex tw-items-center tw-justify-between"},Qe={class:"tw-text-center"},Ze={key:1,class:"messages-list"},es=ee({__name:"index",async setup(J){let w,d;const{t:i}=Ce(),D={type:Ee.ACCORDION,style:{accordionContainerClass:"filter-accordion"}},N=[{key:0,label:i("all")},{key:1,label:i("read")},{key:2,label:i("unread")}],B=we(),{fetchMessages:v,setRead:L,setUnread:A,deleteMessages:n,setIsUnreadUserMessages:_}=B,M=se(),{shiftOpenedModals:E}=M,{isLessContainerDesktop:$}=te(M),f={read:L,unread:A,delete:n},c=g({page:1,type:0,from:"",to:"",search:"",theme:"dark",limit:10}),l=g([]),r=g(null),m=g(!1),a=g([]),T=g(!1),K=g([]),x=g(!1),ie=F(()=>{var e,t;return((e=a.value)==null?void 0:e.length)===((t=l.value)==null?void 0:t.length)?H.check:H.indeterminate});ae(()=>a.value,()=>{var e;m.value=!1,((e=a.value)==null?void 0:e.length)>0&&(m.value=!0)});const ce=()=>{m.value?a.value=l.value.map(e=>e.id):a.value=[]},re=e=>{a.value.includes(e)?a.value=a.value.filter(t=>t!==e):a.value=[...a.value,e],a.value.length+1<(c.value.limit??0)&&(m.value=!1),a.value.length+1===c.value.limit&&(m.value=!0)},me=e=>{m.value=!1,c.value.page=e.page,C()},ue=()=>{K.value=[{target:"search",componentName:j.SEARCH_INPUT,props:{placeholderText:i("search_dots"),modelValue:"",isRequired:!0}},{target:"date",componentName:j.DATE_PICKER,props:{modelValue:"",modelType:"yyyy-MM-dd",format:"yyyy-MM-dd",isDisabled:!1,labelText:i("date"),range:!0,inputName:"date",multiCalendar:!0},mobile:{redirect:!0}},{target:"type",componentName:j.SINGLE_SELECTOR,props:{modelValue:"",additionalLabel:i("type"),displayedOption:"label",returnedOption:"key",defaultOption:N[0],itemList:N,isAllowEmpty:!1},mobile:{redirect:!0}}]},Y=e=>{var u;const t=((u=e==null?void 0:e.date)==null?void 0:u.length)>0;c.value={...c.value,from:t?e.date[0]:"",to:t?e.date[1]:"",search:e.search,type:Number(e.type)||0,page:1},C()},O=async e=>{var u;if(e==="delete"){l.value=l.value.filter(R=>!a.value.includes(R.id));const P=await f[e](a.value);_(P.unread_company_messages),x.value=!1,m.value=!1,a.value=[],G(),(u=r.value)!=null&&u.next_page&&await C();return}const t=await f[e](a.value);_(t.unread_company_messages),a.value=[],C()},C=async()=>{try{T.value=!0;const e=await v(Ve(c.value));l.value=e.messages,r.value=e.pagination,_(e.unread_company_messages)}catch(e){console.error("getData messages -> index",e)}finally{T.value=!1}},pe=e=>{Y(e)},G=()=>{x.value=!1,E()};return Ne(()=>ue()),[w,d]=Me(async()=>De(async()=>{await C()},"$ogd0YzJqUM")),await w,d(),$e(),Te({title:"Messages"}),(e,t)=>{const u=Ie,P=Oe,R=le,U=Be,de=Le,ge=Ke,_e=Ae,fe=Pe,ye=Se,ve=Re;return y(),S("div",{class:q(["messages",{"messages--mobile":s($)}])},[p("h1",Ye,[o(u,{name:"message_unread",size:24}),xe(" "+b(s(i)("messages")),1)]),o(P,{"mobile-settings":D,list:s(K),class:q(["filter-list",{"filter-list--mobile":s($)}]),onChange:Y,onInput:pe},null,8,["list","class"]),o(ye,{loading:s(T)},{default:k(()=>{var z,W,X;return[p("div",Ge,[p("div",We,[(z=s(l))!=null&&z.length?(y(),V(R,{key:0,modelValue:s(m),"onUpdate:modelValue":t[0]||(t[0]=h=>ne(m)?m.value=h:null),type:s(ie),onChange:ce},null,8,["modelValue","type"])):I("",!0),(W=s(a))!=null&&W.length?(y(),S("div",Xe,[o(U,{"is-with-icon":"",class:"messages-action","color-type":"transparent","icon-position":"right","label-key":"read",onClick:t[1]||(t[1]=h=>O("read"))},{default:k(()=>[o(u,{name:"message_read",size:20})]),_:1}),o(U,{"is-with-icon":"",class:"messages-action","color-type":"transparent","icon-position":"right","label-key":"unread",onClick:t[2]||(t[2]=h=>O("unread"))},{default:k(()=>[o(u,{name:"message_unread",size:20})]),_:1}),o(U,{"is-with-icon":"",class:"messages-action","color-type":"transparent","icon-position":"right","label-key":"delete",onClick:t[3]||(t[3]=h=>x.value=!0)},{default:k(()=>[o(u,{name:"delete",size:20})]),_:1})])):I("",!0)]),!((X=s(l))!=null&&X.length)&&!s(T)?(y(),V(de,{key:0},{content:k(()=>[p("div",Qe,b(s(i)("no_result")),1)]),_:1})):(y(),S("div",Ze,[o(_e,{list:s(l),container:!1,"key-name":"messages-list"},{item:k(({item:h})=>[o(ge,{item:h,checked:s(a).includes(h.id),onSelect:re},null,8,["item","checked"])]),_:1},8,["list"]),s(r)&&s(r).total_pages>1?(y(),V(fe,{key:0,"current-page":s(c).page,pages:s(r).total_pages,"per-page":s(r).per_page,total:s(r).total,class:"tw-py-4",onChange:me},null,8,["current-page","pages","per-page","total"])):I("",!0)]))])]}),_:1},8,["loading"]),s(x)?(y(),V(ve,{key:0,onConfirm:t[4]||(t[4]=z=>O("delete")),onClose:G})):I("",!0)],2)}}}),ps=oe(es,[["__scopeId","data-v-02fbd99a"]]);export{ps as default};
