import{_ as K}from"./DqC-nx6a.js";import{c as _,_ as Q}from"./D4aeT6U_.js";import{d as X,m as Y,j as Z,aN as ee,I as te,a as oe,aV as ne,ag as d,s as b,a0 as f,H as N,aP as se,k as le,o as v,B as C,b as i,C as h,e as l,t as y,g as e,aW as re,i as M,T as ae,h as ie,A as ce,_ as ue}from"./7PQ9d4dP.js";import{_ as de}from"./CXUEa_s4.js";import{c as me,_ as pe}from"./BQWyzQZp.js";import{_ as _e}from"./UCCBr-NG.js";import"./DD170oM2.js";import"./D0WEjs_T.js";const fe={class:"tw-font-bold"},he={class:"tw-flex tw-flex-col tw-gap-4 tw-p-4 tw-h-full"},ye={class:"tw-flex tw-items-center slot-option"},ge={class:"tw-flex"},we={class:"tw-ml-2"},xe={class:"country-label fg-text-14-thin"},ve={class:"country-name fg-text-14-thin"},Ce={class:"tw-flex tw-items-center"},Ve={class:"tw-ml-2"},Se={class:"country-name fg-text-14-thin"},be={class:"tw-flex tw-justify-center tw-mt-auto"},Ne=X({__name:"ProductBuyModal",props:{product:{}},emits:["close","success"],setup(q,{emit:$}){const{product:g}=q,m=$,z=Y(),O=Z(),P=ee(),V=te(),{t:u}=oe(),{submitOrder:k}=P,{fetchProfile:B}=V,{fetchSettings:U,fetchData:D}=z,{handleSubmit:E}=me({validationSchema:ne({full_name:d().required(),country:d().required(),phone:d().min(6).max(16).required(),city:d().required(),street:d().required(),zip_code:d().required()})}),{getCountryCode:I}=b(O),{getProfileInfo:S}=b(V),R=new Map(_.map(s=>[s.iso2,s])),p=f(null),n=f({full_name:"",country:"",phone:"",city:"",street:"",zip_code:""}),w=f(""),x=f({}),T=N(()=>g.is_bonus||g.type===4),L=N(()=>T.value?u("product_with_out_order_heading"):u("shipping_address")),j=()=>{var s,t,c;if((t=(s=S.value)==null?void 0:s.country_code)!=null&&t.length)_.forEach(r=>{r.iso2===S.value.country_code&&(w.value=r.phone_code,n.value.country=r.iso2,x.value=r)});else{const r=((c=I.value)==null?void 0:c.toLowerCase())??"",a=R.get(r)??_[0];w.value=a.phone_code,n.value.country=a.iso2,x.value=a}},A=E(async()=>{var s;p.value=null;try{await k({...n.value,id:g.id}),U(),D(),m("close"),m("success")}catch(t){const{error_code:c,latestDate:r=null}=t,a=(s=t==null?void 0:t.errors)==null?void 0:s.zip_code;a&&(p.value={msg:a[0]}),c===se.BONUS_CANNOT_BE_CLOSED&&r&&m("close")}}),W=s=>{n.value.phone=`${s.phoneCode}${s.phone}`};return le(async()=>{try{await B()}catch(s){console.error(s)}j()}),(s,t)=>{const c=K,r=Q,a=ie,F=de,H=pe,G=ce,J=_e;return v(),C(ae,{to:"#globalModal"},[i(J,{class:"buy-modal","fullscreen-mode":"","modal-max-width":"512px",onClose:t[6]||(t[6]=o=>m("close"))},{title:h(()=>[l("h2",fe,y(e(L)),1)]),content:h(()=>[l("form",he,[i(c,{modelValue:e(n).full_name,"onUpdate:modelValue":t[0]||(t[0]=o=>e(n).full_name=o),modelModifiers:{trim:!0},"placeholder-text":e(u)("full_name"),"is-required":!0,"input-name":"full_name"},null,8,["modelValue","placeholder-text"]),i(r,{modelValue:e(n).phone,"onUpdate:modelValue":t[1]||(t[1]=o=>e(n).phone=o),class:"settings-input settings-phone","default-code":e(w),"is-required":!0,"input-name":"phone",onChange:W},null,8,["modelValue","default-code"]),i(F,{modelValue:e(n).country,"onUpdate:modelValue":t[2]||(t[2]=o=>e(n).country=o),"default-option":e(x),"additional-label":s.$t("country"),"displayed-option":"name",placeholder:s.$t("country"),"returned-option":"iso2","item-list":e(_),"is-required":!0,"input-name":"country","is-search-icon":"","is-searchable":""},{"selected-option":h(({props:o})=>[l("div",ye,[i(a,{"is-init-color":!0,name:o.iso2,size:24,folder:"flags",class:"country-flag"},null,8,["name"]),l("div",ge,[o.iso2?M("",!0):(v(),C(a,{key:0,color:e(re)["fg-tertiary"],name:"country",size:20},null,8,["color"])),l("div",we,[l("p",xe,y(e(u)("country")),1),l("p",ve,y(o.name),1)])])])]),option:h(({props:o})=>[l("div",Ce,[i(a,{"is-init-color":!0,name:o.iso2,size:24,folder:"flags",class:"country-flag"},null,8,["name"]),l("div",Ve,[l("p",Se,y(o.name),1)])])]),_:1},8,["modelValue","default-option","additional-label","placeholder","item-list"]),i(c,{modelValue:e(n).city,"onUpdate:modelValue":t[3]||(t[3]=o=>e(n).city=o),modelModifiers:{trim:!0},"placeholder-text":e(u)("enter_city"),"is-required":!0,"input-name":"city"},null,8,["modelValue","placeholder-text"]),i(c,{modelValue:e(n).street,"onUpdate:modelValue":t[4]||(t[4]=o=>e(n).street=o),modelModifiers:{trim:!0},"placeholder-text":e(u)("enter_details"),"is-required":!0,"input-name":"street"},null,8,["modelValue","placeholder-text"]),i(c,{modelValue:e(n).zip_code,"onUpdate:modelValue":t[5]||(t[5]=o=>e(n).zip_code=o),modelModifiers:{trim:!0},"placeholder-text":e(u)("enter_zip_code"),"is-required":!0,"input-name":"zip_code"},null,8,["modelValue","placeholder-text"]),e(p)?(v(),C(H,{key:0,error:e(p)},null,8,["error"])):M("",!0),l("div",be,[i(G,{"label-key":e(u)("submit"),"color-type":"primary",class:"tw-w-full",onClick:e(A)},null,8,["label-key","onClick"])])])]),_:1})])}}}),Ue=ue(Ne,[["__scopeId","data-v-3e07047c"]]);export{Ue as default};
