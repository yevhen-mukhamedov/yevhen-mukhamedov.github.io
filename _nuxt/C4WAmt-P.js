import{d as W,a as At,J as yt,X as ht,L as Nt,ai as It,aa as wt,m as Bt,aT as Tt,s as $t,a0 as Pt,H as r,bm as m,bn as e,bo as Vt,o as u,c as E,g as n,B,C as V,b as f,i as p,e as a,t as o,f as h,n as D,ao as Yt,W as K,h as X,aL as gt,A as kt,p as q,_ as Ct,U as C,r as S}from"./7PQ9d4dP.js";import{p as Dt,_ as Gt}from"./RQfXHScZ.js";import{_ as Kt}from"./ao6LVzqx.js";import{a as St}from"./Do2gu6g3.js";const zt={class:"tw-flex tw-items-center"},Ft={class:"tw-flex tw-flex-col tw-items-center"},Mt={key:0},Ht={key:0},Ot={key:1,class:"tw-flex tw-items-center tw-mt-1"},Jt={key:0,class:"tw-flex tw-flex-col tw-items-center tw-p-4"},Rt={class:"tw-text-center tw-text-base"},jt={key:0,class:"tw-text-center tw-text-base tw-mt-2"},Wt={class:"tw-flex tw-items-center tw-justify-center"},Xt={key:1,class:"desc"},qt=W({__name:"NgBattleButton",props:{battle:{}},emits:["update-list"],setup(T,{emit:A}){const{t:b}=At(),{show:t}=yt(),L=ht(),{platformCommasFormat:Y}=Nt(),v=It(),y=wt(),$=Bt(),N=Tt(),{setGameError:Q}=N,{defaultGameError:Z}=N,{getUserBattle:i,getUserId:I}=$t($),{PVP_LOBBY_LINK:g,PVP_BATTLES:k,PVP_BATTLE_ID:he}=Yt,z=A,l=T,F=v.meta.metaName,_=Pt({title:"delete_battle",subTitle:"are_you_sure_want_to_delete",description:"this_actions_cannot_be_reversed",acceptText:"delete_pvp_battle",show:!1,type:"delete"}),M=(s="delete")=>{s==="leave"&&(_.value.title="leave_battle",_.value.acceptText="agree_and_leave"),_.value.type=s,_.value.show=!0},U=r(()=>v.meta.metaName===k),w=r(()=>v.meta.metaName===g),H=r(()=>{var s,d;return((s=i==null?void 0:i.value)==null?void 0:s.battle_id)&&((d=i==null?void 0:i.value)==null?void 0:d.battle_id)!==l.battle.id&&l.battle.battle_status===m.AVAILABLE_KEY}),x=r(()=>{var s;return((s=i==null?void 0:i.value)==null?void 0:s.battle_id)&&(I==null?void 0:I.value)===l.battle.player_id&&l.battle.battle_status===m.AVAILABLE_KEY}),tt=r(()=>l.battle.battle_status===m.FINISHED_KEY),et=r(()=>{var s;return!((s=i==null?void 0:i.value)!=null&&s.battle_id)&&l.battle.battle_status===m.AVAILABLE_KEY&&w.value}),st=r(()=>{var s;return((s=i==null?void 0:i.value)==null?void 0:s.battle_id)===l.battle.id&&(I==null?void 0:I.value)!==l.battle.player_id&&l.battle.battle_status===m.AVAILABLE_KEY&&w.value}),at=r(()=>l.battle.battle_status===m.PLAYING_KEY&&U.value),nt=r(()=>l.battle.battle_status===m.PLAYING_KEY&&w.value&&l.battle.player_status&&l.battle.player_status===m.DELETED_KEY),lt=r(()=>l.battle.battle_status===m.PLAYING_KEY&&w.value&&l.battle.player_status&&l.battle.player_status!==m.PLAYING_KEY),ot=r(()=>l.battle.battle_status===m.PLAYING_KEY&&w.value&&l.battle.player_status===m.PLAYING_KEY),c=r(()=>H.value?e.UNAVAILABLE:x.value?e.AVAILABLE_DELETE:tt.value?e.COMPLETED:et.value?e.JOIN_BATTLE:st.value?e.LEAVE_BATTLE:at.value||nt.value?e.PLAYING:lt.value?e.PLAYING_LEAVE:ot.value?e.FINISHED:Vt[l.battle.battle_status]),it=r(()=>[e.UNAVAILABLE,e.COMPLETED,e.CANCELED].includes(c.value)?"dark":[e.PLAYING,e.FINISHED,e.LEAVE_BATTLE].includes(c.value)?"secondary":"primary"),O=r(()=>[e.AVAILABLE,e.UNAVAILABLE,e.AVAILABLE_DELETE,e.JOIN_BATTLE,e.LEAVE_BATTLE,e.PLAYING_LEAVE,e.PLAYING,e.FINISHED].includes(c.value)),J=r(()=>[g,k].includes(F)),rt=r(()=>c.value===e.PLAYING_LEAVE&&J.value),ct=r(()=>c.value===e.AVAILABLE_DELETE&&J.value),G=r(()=>H.value?b("in_the_match"):null),ut=r(()=>[e.AVAILABLE,e.AVAILABLE_DELETE,e.JOIN_BATTLE,e.LEAVE_BATTLE].includes(c.value)?b("open"):[e.PLAYING,e.PLAYING_LEAVE].includes(c.value)?b("live"):c.value===e.FINISHED?b("results_in"):null),_t=async()=>{_.value.show=!1;try{_.value.type==="delete"?await pt():await R(),v.meta.metaName===k?z("update-list"):y.push(L(K.pvp_battle))}catch(s){console.error("confirmHandler NgBattleButton",s)}},dt=()=>{Q(Z)},mt=()=>{c.value===e.JOIN_BATTLE&&l.battle.hover&&l.battle.hover.show&&t({message:"Here must be text about battle.hover params",position:"bottom-right"}),c.value===e.PLAYING&&v.meta.metaName!==g&&y.push(L({name:"battles-lobby-id",params:{id:l.battle.link}})),c.value===e.PLAYING_LEAVE?y.push(L(`${K.pvp_battle}/${l.battle.id}`)):c.value===e.LEAVE_BATTLE?R():(c.value===e.JOIN_BATTLE||c.value===e.AVAILABLE&&F===g)&&bt()},pt=async()=>{var s;try{await N.deleteBattle({battleId:(s=i==null?void 0:i.value)==null?void 0:s.battle_id})}catch(d){console.error("onDelete NgBattleButton",d)}},R=async()=>{var s,d;try{await N.leaveBattle({battleId:Number((s=l==null?void 0:l.battle)==null?void 0:s.battle_id)||Number((d=i==null?void 0:i.value)==null?void 0:d.battle_id)}),$.setUserBattle(null),v.meta.metaName===k?z("update-list"):y.push(L(K.pvp_battle))}catch(P){console.error("onLeave NgBattleButton",P)}},bt=async()=>{const{data:s}=await N.joinBattle({battleId:l.battle.battle_id});$.setUserBattle(s),s.battle_id===2&&y.push(L({name:"battles-id",params:{id:s.battle_id}}))};return(s,d)=>{const P=X,j=gt,vt=Kt,ft=kt,Et=q,Lt=St;return u(),E("div",zt,[n(rt)?(u(),B(j,{key:0,class:"leave-button tw-mr-1","color-type":"secondary",size:"large",onClick:d[0]||(d[0]=()=>M("leave"))},{default:V(()=>[f(P,{name:"leave",size:24})]),_:1})):p("",!0),f(ft,{class:"tw-w-full",link:n(L)({name:"battles-lobby-id",params:{id:l.battle.link}}),"is-link":!n(w),"color-type":n(it),size:"large",onClick:mt},{default:V(()=>[a("span",Ft,[a("span",null,o(n(b)(n(c))),1),n(O)||n(G)?(u(),E("span",Mt,[n(G)?(u(),E("span",Ht,o(n(G)),1)):p("",!0),n(O)?(u(),E("span",Ot,[[n(e).PLAYING,n(e).PLAYING_LEAVE].includes(n(c))?(u(),B(P,{key:0,name:"stream_battle",size:12})):p("",!0),h(" "+o(n(ut))+"Â  ",1),f(vt,{id:`${s.battle.battle_id}-timer`,"hidden-days":!0,"hidden-hours":!0,"end-time":s.battle.timer*1e3,class:"tw-font-bold",onCountdownFinished:dt},null,8,["id","end-time"])])):p("",!0)])):p("",!0)])]),_:1},8,["link","is-link","color-type"]),n(ct)?(u(),B(j,{key:1,class:"delete-button tw-ml-1","color-type":"secondary",size:"large",onClick:M},{default:V(()=>[f(P,{name:"delete",size:24})]),_:1})):p("",!0),n(_).show?(u(),B(Lt,{key:2,"sub-title":n(_).subTitle,description:n(_).description,title:n(_).title,"accept-text":n(_).acceptText,onClose:d[1]||(d[1]=Ne=>n(_).show=!1),onConfirm:_t},{content:V(()=>[n(_).type==="leave"?(u(),E("div",Jt,[a("p",Rt,o(s.$t("are_you_sure_want_to_leave")),1),s.battle.entry_fee?(u(),E("div",jt,[h(o(s.$t("your_entry_fee_will_not_be_refounded"))+" ",1),a("div",Wt,[a("span",null,o(n(Y)(n(Dt),s.battle.entry_fee)),1),s.battle.battle_currency?(u(),B(Et,{key:0,src:n(D)(s.battle.battle_currency),alt:s.battle.battle_currency,class:"tw-ms-1"},null,8,["src","alt"])):p("",!0)])])):(u(),E("div",Xt,o(s.$t("your_entry_fee_will_be_refounded")),1))])):p("",!0)]),_:1},8,["sub-title","description","title","accept-text"])):p("",!0)])}}}),Qt=Ct(qt,[["__scopeId","data-v-97649cc2"]]),Zt=T=>{const A=Math.floor(T/60),b=T-A*60;return`${A<10?"0"+A:A}:${b<10?"0"+b:b}`},Ut={class:"picture"},xt={class:"content"},te={key:0,class:"item"},ee={class:"text center-gap"},se={class:"info center-gap"},ae={class:"item"},ne={class:"text center-gap"},le={class:"info center-gap"},oe={class:"item"},ie={class:"text center-gap"},re={class:"info center-gap"},ce={key:1,class:"item"},ue={class:"text center-gap"},_e={class:"info center-gap"},de={class:"item"},me={class:"text center-gap"},pe={class:"info center-gap"},be={class:"item"},ve={class:"text center-gap"},fe={class:"info center-gap"},Ee={class:"item"},Le={class:"text center-gap tooltip"},Ae={class:"tooltip info"},ye={class:"info center-gap"},$e=W({__name:"BattleItem",props:{classList:{default:""},item:{},isColumn:{type:Boolean,default:!1}},emits:["update-list"],setup(T,{emit:A}){const b=A;return(t,L)=>{const Y=X,v=q,y=Gt,$=Qt;return u(),E("div",{class:C(["ng-battle-item",t.isColumn?"tw-flex-col":"",t.classList])},[a("picture",Ut,[t.isColumn?p("",!0):(u(),B(Y,{key:0,name:t.item.battle_type,folder:"pvp",class:"icon"},null,8,["name"])),f(v,{src:t.item.banner_vertical,alt:t.item.link,class:C(["image",t.isColumn?"image-col":""])},null,8,["src","alt","class"])]),a("div",{class:C(["wrapper",t.isColumn?"tw-mt-4":""])},[a("div",xt,[S(t.$slots,"caption",{props:t.item}),S(t.$slots,"item",{props:t.item},()=>[t.isColumn?(u(),E("dl",te,[a("dt",ee,o(t.$t("type")),1),a("dd",se,[h(o(t.$t(t.item.battle_type))+" ",1),f(Y,{name:t.item.battle_type,size:16,folder:"pvp"},null,8,["name"])])])):p("",!0),a("dl",ae,[a("dt",ne,o(t.$t("entry_fee")),1),a("dd",le,[h(o(t.item.entry_fee)+" ",1),f(v,{src:n(D)(t.item.battle_currency),alt:t.item.battle_currency},null,8,["src","alt"])])]),a("dl",oe,[a("dt",ie,o(t.$t("stake_amount")),1),a("dd",re,[h(o(t.item.stake_amount)+" ",1),f(v,{src:n(D)(t.item.battle_currency),alt:t.item.battle_currency},null,8,["src","alt"])])]),t.item.duration&&t.isColumn?(u(),E("dl",ce,[a("dt",ue,o(t.$t("duration")),1),a("dd",_e,o(n(Zt)(t.item.duration)),1)])):p("",!0),a("dl",de,[a("dt",me,o(t.$t("spins_count")),1),a("dd",pe,o(t.item.spins_count),1)]),a("dl",be,[a("dt",ve,o(t.$t("players")),1),a("dd",fe,o(t.item.active_participant_count)+" / "+o(t.item.participant_count),1)]),a("dl",Ee,[a("dt",Le,[h(o(t.$t("prize"))+" ",1),f(y,null,{content:V(()=>[a("div",Ae,[a("div",null,o(t.$t("prize_tooltip")),1),a("div",null,o(t.$t("platform_fee"))+" "+o(t.item.company_fee)+"%",1)])]),_:1})]),a("dd",ye,[h(o(t.item.prize)+" ",1),f(v,{src:n(D)(t.item.battle_currency),alt:t.item.battle_currency},null,8,["src","alt"])])])])]),a("div",{class:C(["actions",t.isColumn?"tw-mt-4":"tw-mt-1.5"])},[S(t.$slots,"actions",{props:t.item},()=>[f($,{battle:t.item,onUpdateList:L[0]||(L[0]=N=>b("update-list"))},null,8,["battle"])])],2)],2)],2)}}});export{$e as _};
